<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: PoolParty::Remote::Ec2 [RDoc Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          PoolParty::Remote::Ec2
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/lib/poolparty/net/remoter_bases/ec2/ec2_rb.html">lib/poolparty/net/remoter_bases/ec2/ec2.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Remote::RemoterBase</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000516">ec2</a></li>
              <li><a href="#M000510">launch_new_instance!</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000532">after_install_tasks_for</a></li>
              <li><a href="#M000521">after_launch_instance</a></li>
              <li><a href="#M000523">associate_address</a></li>
              <li><a href="#M000522">attach_volume</a></li>
              <li><a href="#M000520">aws_keys</a></li>
              <li><a href="#M000525">create_keypair</a></li>
              <li><a href="#M000526">create_snapshot</a></li>
              <li><a href="#M000533">custom_configure_tasks_for</a></li>
              <li><a href="#M000531">custom_install_tasks_for</a></li>
              <li><a href="#M000530">custom_minimum_runnable_options</a></li>
              <li><a href="#M000513">describe_instance</a></li>
              <li><a href="#M000514">describe_instances</a></li>
              <li><a href="#M000515">ec2</a></li>
              <li><a href="#M000518">get_descriptions</a></li>
              <li><a href="#M000517">get_instances_description</a></li>
              <li><a href="#M000527">has_cert_and_key?</a></li>
              <li><a href="#M000519">keypair</a></li>
              <li><a href="#M000511">launch_new_instance!</a></li>
              <li><a href="#M000524">next_unused_elastic_ip</a></li>
              <li><a href="#M000529">private_key</a></li>
              <li><a href="#M000528">pub_key</a></li>
              <li><a href="#M000534">reset_base!</a></li>
              <li><a href="#M000512">terminate_instance!</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000516'>
                <a name='M000516'>      </a>
                <div class='synopsis'>
                  <span class='name'>ec2</span>
                  <span class='arguments'>(o)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000516-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000516-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 107</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>)&#x000A;        <span class="ruby-ivar">@ec2</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>)&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000510'>
                <a name='M000510'>      </a>
                <div class='synopsis'>
                  <span class='name'>launch_new_instance!</span>
                  <span class='arguments'>(parent_cloud, o)</span>
                </div>
                <div class='description'>
                  <p>
                  Requires a hash of options
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000510-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000510-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 50</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">launch_new_instance!</span>(<span class="ruby-identifier">parent_cloud</span>, <span class="ruby-identifier">o</span>)&#x000A;        <span class="ruby-identifier">new</span>(<span class="ruby-identifier">parent_cloud</span>, <span class="ruby-identifier">o</span>).<span class="ruby-identifier">launch_new_instance!</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000532'>
                <a name='M000532'>      </a>
                <div class='synopsis'>
                  <span class='name'>after_install_tasks_for</span>
                  <span class='arguments'>(o)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000532-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000532-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 235</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_install_tasks_for</span>(<span class="ruby-identifier">o</span>)&#x000A;        [&#x000A;          <span class="ruby-comment cmt"># &quot;cd /var/poolparty &amp;&amp; wget http://rubyforge.org/frs/download.php/43666/amazon-ec2-0.3.1.gem -O amazon-ec2.gem 2&gt;&amp;1&quot;,</span>&#x000A;          <span class="ruby-comment cmt"># &quot;/usr/bin/gem install --no-ri --no-rdoc amazon-ec2.gem 2&gt;&amp;1&quot;</span>&#x000A;        ]&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000521'>
                <a name='M000521'>      </a>
                <div class='synopsis'>
                  <span class='name'>after_launch_instance</span>
                  <span class='arguments'>(inst)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000521-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000521-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 136</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_launch_instance</span>(<span class="ruby-identifier">inst</span>)&#x000A;        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">inst</span>&#x000A;          <span class="ruby-identifier">associate_address</span>(<span class="ruby-identifier">inst</span>)&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000523'>
                <a name='M000523'>      </a>
                <div class='synopsis'>
                  <span class='name'>associate_address</span>
                  <span class='arguments'>(instance=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Associate an address with the instance using ec2 Get the <a
                  href="Ec2.html#M000524">next_unused_elastic_ip</a> and if there is one,
                  associate the instance to the public ip
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000523-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000523-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 156</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">associate_address</span>(<span class="ruby-identifier">instance</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ip</span> = <span class="ruby-identifier">next_unused_elastic_ip</span>&#x000A;          <span class="ruby-identifier">vputs</span> <span class="ruby-node">&quot;Associating #{instance.instance_id} with #{ip}&quot;</span>&#x000A;          <span class="ruby-identifier">ec2</span>.<span class="ruby-identifier">associate_address</span>(<span class="ruby-identifier">:instance_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">instance</span>.<span class="ruby-identifier">instance_id</span>, <span class="ruby-identifier">:public_ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ip</span>)&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000522'>
                <a name='M000522'>      </a>
                <div class='synopsis'>
                  <span class='name'>attach_volume</span>
                  <span class='arguments'>(instance=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Attach a volume to the instance DEPRECATE this relies on master. master
                  will be removed in next major release. This method will be in
                  ec2_remote_instance instead, or require an instance id
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000522-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000522-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 144</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attach_volume</span>(<span class="ruby-identifier">instance</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ebs_volume_id</span>&#x000A;          <span class="ruby-identifier">vputs</span> <span class="ruby-node">&quot;Attaching volume #{ebs_volume_id} to the master at #{ebs_volume_device}&quot;</span>&#x000A;          <span class="ruby-identifier">instance</span> = <span class="ruby-identifier">master</span>        &#x000A;          <span class="ruby-identifier">ec2</span>.<span class="ruby-identifier">attach_volume</span>(<span class="ruby-identifier">:volume_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ebs_volume_id</span>, <span class="ruby-identifier">:instance_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">instance</span>.<span class="ruby-identifier">instance_id</span>, <span class="ruby-identifier">:device</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ebs_volume_device</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ebs_volume_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ebs_volume_mount_point</span>&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000520'>
                <a name='M000520'>      </a>
                <div class='synopsis'>
                  <span class='name'>aws_keys</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  <a href="../../Class.html">Class</a> method helpers
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000520-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000520-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 126</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">aws_keys</span>&#x000A;        <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@access_key</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@secret_access_key</span>          &#x000A;          <span class="ruby-identifier">aws_keys</span> = {}&#x000A;          <span class="ruby-identifier">aws_keys</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-value str">'/etc/poolparty/aws_keys.yml'</span>) ) <span class="ruby-keyword kw">rescue</span> <span class="ruby-value str">'No aws_keys.yml file.   Will try to use enviornment variables'</span>&#x000A;          <span class="ruby-ivar">@access_key</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">aws_keys</span>[<span class="ruby-identifier">:access_key</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AMAZON_ACCESS_KEY_ID'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AWS_ACCESS_KEY'</span>]&#x000A;          <span class="ruby-ivar">@secret_access_key</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">aws_keys</span>[<span class="ruby-identifier">:secret_access_key</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AMAZON_SECRET_ACCESS_KEY'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AWS_SECRET_ACCESS_KEY'</span>]&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;        [<span class="ruby-ivar">@access_key</span>, <span class="ruby-ivar">@secret_access_key</span>]&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000525'>
                <a name='M000525'>      </a>
                <div class='synopsis'>
                  <span class='name'>create_keypair</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Help create a keypair for the cloud This is a helper to create the keypair
                  and add them to the cloud for you
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000525-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000525-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 191</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_keypair</span>&#x000A;        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keypair</span>&#x000A;        <span class="ruby-keyword kw">unless</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-identifier">new_keypair_path</span> )&#x000A;          <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>( <span class="ruby-identifier">new_keypair_path</span> )&#x000A;          <span class="ruby-identifier">vputs</span> <span class="ruby-node">&quot;Creating keypair: #{keypair} in #{new_keypair_path}&quot;</span>&#x000A;          <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">system</span> <span class="ruby-node">&quot;ec2-add-keypair #{keypair} &gt; #{new_keypair_path} &amp;&amp; chmod 600 #{new_keypair_path}&quot;</span>&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000526'>
                <a name='M000526'>      </a>
                <div class='synopsis'>
                  <span class='name'>create_snapshot</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  wrapper for remote base to perform a snapshot backup for the ebs volume
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000526-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000526-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 201</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_snapshot</span>&#x000A;        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ebs_volume_id</span>.<span class="ruby-identifier">nil?</span>&#x000A;        <span class="ruby-identifier">ec2</span>.<span class="ruby-identifier">create_snapshot</span>(<span class="ruby-identifier">:volume_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ebs_volume_id</span>)&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000533'>
                <a name='M000533'>      </a>
                <div class='synopsis'>
                  <span class='name'>custom_configure_tasks_for</span>
                  <span class='arguments'>(o)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000533-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000533-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 242</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">custom_configure_tasks_for</span>(<span class="ruby-identifier">o</span>)&#x000A;        [&#x000A;        ]&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000531'>
                <a name='M000531'>      </a>
                <div class='synopsis'>
                  <span class='name'>custom_install_tasks_for</span>
                  <span class='arguments'>(o)</span>
                </div>
                <div class='description'>
                  <pre>Hook</pre>
                  <p>
                  TODO#: Change this so they match with the cap tasks
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000531-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000531-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 226</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">custom_install_tasks_for</span>(<span class="ruby-identifier">o</span>)        &#x000A;        [&#x000A;          <span class="ruby-comment cmt"># &quot;if [ -z $(grep -v '#' /etc/hosts | grep '#{o.name}') ]; then echo \&quot;$(curl http://169.254.169.254/latest/meta-data/public-ipv4) #{o.name}\&quot; &gt;&gt; /etc/hosts; fi&quot;,</span>&#x000A;          <span class="ruby-node">&quot;if [ -z \&quot;$(grep -v '#' /etc/hosts | grep '#{o.name}')\&quot; ]; then echo '127.0.0.1 #{o.name}' &gt;&gt; /etc/hosts; fi&quot;</span>,&#x000A;          <span class="ruby-node">&quot;hostname #{o.name}&quot;</span>,&#x000A;          <span class="ruby-node">&quot;echo #{o.name} &gt; /etc/hostname&quot;</span>&#x000A;        ]&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000530'>
                <a name='M000530'>      </a>
                <div class='synopsis'>
                  <span class='name'>custom_minimum_runnable_options</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000530-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000530-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 220</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">custom_minimum_runnable_options</span>&#x000A;        [<span class="ruby-identifier">:ami</span>, <span class="ruby-identifier">:availabilty_zone</span>, <span class="ruby-identifier">:security_group</span>]&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000513'>
                <a name='M000513'>      </a>
                <div class='synopsis'>
                  <span class='name'>describe_instance</span>
                  <span class='arguments'>(o={})</span>
                </div>
                <div class='description'>
                  <p>
                  Describe an instance&#8217;s status
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000513-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000513-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 74</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">describe_instance</span>(<span class="ruby-identifier">o</span>={})&#x000A;        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">describe_instances</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>].<span class="ruby-identifier">nil?</span>&#x000A;        <span class="ruby-identifier">describe_instances</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:name</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:ip</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:instance_id</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>] }&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000514'>
                <a name='M000514'>      </a>
                <div class='synopsis'>
                  <span class='name'>describe_instances</span>
                  <span class='arguments'>(o={})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000514-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000514-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 78</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">describe_instances</span>(<span class="ruby-identifier">o</span>={})&#x000A;        <span class="ruby-identifier">id</span> = <span class="ruby-value">0</span>&#x000A;        <span class="ruby-identifier">get_instances_description</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">o</span>)).<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span>          &#x000A;          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">:status</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;running&quot;</span>&#x000A;            <span class="ruby-identifier">inst_name</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;master&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;node#{id}&quot;</span>&#x000A;            <span class="ruby-identifier">id</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;          <span class="ruby-keyword kw">else</span>&#x000A;            <span class="ruby-identifier">inst_name</span> = <span class="ruby-node">&quot;#{h[:status]}_node#{i}&quot;</span>&#x000A;          <span class="ruby-keyword kw">end</span>&#x000A;          <span class="ruby-identifier">h</span>.<span class="ruby-identifier">merge!</span>({&#x000A;            <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">inst_name</span>,&#x000A;            <span class="ruby-identifier">:hostname</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">:ip</span>],&#x000A;            <span class="ruby-identifier">:ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">:ip</span>].<span class="ruby-identifier">convert_from_ec2_to_ip</span>,&#x000A;            <span class="ruby-identifier">:index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>,  <span class="ruby-comment cmt">#TODO MF get the instance id from the aws result instead</span>&#x000A;            <span class="ruby-identifier">:launching_time</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">:launching_time</span>])&#x000A;          })&#x000A;        <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">sort</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:index</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">:index</span>] }&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000515'>
                <a name='M000515'>      </a>
                <div class='synopsis'>
                  <span class='name'>ec2</span>
                  <span class='arguments'>(o={})</span>
                </div>
                <div class='description'>
                  <p>
                  return or create a new base EC2 connection object that will actually
                  connect to ec2
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000515-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000515-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 102</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>={})&#x000A;        <span class="ruby-ivar">@ec2</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">EC2</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">:access_key_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:access_key</span>], &#x000A;                                <span class="ruby-identifier">:secret_access_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:secret_access_key</span>]&#x000A;                              )&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000518'>
                <a name='M000518'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_descriptions</span>
                  <span class='arguments'>(o={})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000518-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000518-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 117</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_descriptions</span>(<span class="ruby-identifier">o</span>={})&#x000A;        <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">get_descriptions</span>(<span class="ruby-identifier">o</span>)&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000517'>
                <a name='M000517'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_instances_description</span>
                  <span class='arguments'>(o={})</span>
                </div>
                <div class='description'>
                  <p>
                  Get the ec2 description for the response in a hash format
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000517-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000517-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 112</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_instances_description</span>(<span class="ruby-identifier">o</span>={})&#x000A;        <span class="ruby-comment cmt">#TODO: only use keypair.full_filepath</span>&#x000A;        <span class="ruby-identifier">key_hash</span> = {<span class="ruby-identifier">:keypair</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">keypair</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">full_filepath</span>)}&#x000A;        <span class="ruby-constant">EC2ResponseObject</span>.<span class="ruby-identifier">get_descriptions</span>(<span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>).<span class="ruby-identifier">describe_instances</span>).<span class="ruby-identifier">select_with_hash</span>(<span class="ruby-identifier">key_hash</span>)&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000527'>
                <a name='M000527'>      </a>
                <div class='synopsis'>
                  <span class='name'>has_cert_and_key?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000527-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000527-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 206</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_cert_and_key?</span>&#x000A;        <span class="ruby-identifier">pub_key</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">private_key</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000519'>
                <a name='M000519'>      </a>
                <div class='synopsis'>
                  <span class='name'>keypair</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000519-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000519-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 121</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keypair</span>&#x000A;        <span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">keypair</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000511'>
                <a name='M000511'>      </a>
                <div class='synopsis'>
                  <span class='name'>launch_new_instance!</span>
                  <span class='arguments'>(o={})</span>
                </div>
                <div class='description'>
                  <p>
                  TODO: Fix the key_name issue Start a new instance with the given options
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000511-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000511-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 56</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">launch_new_instance!</span>(<span class="ruby-identifier">o</span>={})&#x000A;        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;You must pass a keypair to launch an instance, or else you will not be able to login. options = #{o.inspect}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">keypair</span>&#x000A;        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">merge!</span>( <span class="ruby-identifier">options</span> ).<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">:key_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">basename</span>)&#x000A;        <span class="ruby-identifier">instance</span> = <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>).<span class="ruby-identifier">run_instances</span>(<span class="ruby-identifier">o</span>)&#x000A;        <span class="ruby-keyword kw">begin</span>&#x000A;          <span class="ruby-identifier">h</span> = <span class="ruby-constant">EC2ResponseObject</span>.<span class="ruby-identifier">get_hash_from_response</span>(<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">instancesSet</span>.<span class="ruby-identifier">item</span>.<span class="ruby-identifier">first</span>)&#x000A;          <span class="ruby-comment cmt">#h = instance.instancesSet.item.first</span>&#x000A;        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;          <span class="ruby-identifier">h</span> = <span class="ruby-constant">EC2ResponseObject</span>.<span class="ruby-identifier">get_hash_from_response</span>(<span class="ruby-identifier">instance</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">instance</span>&#x000A;          <span class="ruby-comment cmt"># h = instance</span>&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-identifier">h</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000524'>
                <a name='M000524'>      </a>
                <div class='synopsis'>
                  <span class='name'>next_unused_elastic_ip</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Get the next usable elastic ip First, get the list of addresses from ec2
                  that the client has access to, then select only the ones that are not
                  associated with an instance. If the cloud has set elastic_ips to use, then,
                  using the intersection of the unused ips and those, find the first one
                  available and return that, otherwise, return the first elastic ip available
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000524-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000524-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 170</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_unused_elastic_ip</span>&#x000A;        <span class="ruby-comment cmt"># [{&quot;instanceId&quot;=&gt;nil, &quot;publicIp&quot;=&gt;&quot;174.129.212.93&quot;}, {&quot;instanceId&quot;=&gt;nil, &quot;publicIp&quot;=&gt;&quot;174.129.212.94&quot;}]</span>&#x000A;        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">addressesSet</span> = <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">describe_addresses</span>[<span class="ruby-value str">&quot;addressesSet&quot;</span>]&#x000A;          <span class="ruby-keyword kw">begin</span>&#x000A;            <span class="ruby-identifier">empty_addresses</span> = <span class="ruby-identifier">addressesSet</span>[<span class="ruby-value str">&quot;item&quot;</span>].<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>[<span class="ruby-value str">&quot;instanceId&quot;</span>].<span class="ruby-identifier">nil?</span> }&#x000A;            <span class="ruby-identifier">ips</span> = <span class="ruby-identifier">empty_addresses</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">addr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">addr</span>[<span class="ruby-value str">&quot;publicIp&quot;</span>]}&#x000A;            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">elastic_ips?</span>&#x000A;              <span class="ruby-identifier">ips_to_use</span> = <span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">elastic_ips</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">ips</span>&#x000A;              <span class="ruby-identifier">ips_to_use</span>.<span class="ruby-identifier">first</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;              <span class="ruby-identifier">ips</span>.<span class="ruby-identifier">first</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;          <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;            <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Error: #{e}&quot;</span>&#x000A;            <span class="ruby-keyword kw">nil</span>&#x000A;          <span class="ruby-keyword kw">end</span>          &#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000529'>
                <a name='M000529'>      </a>
                <div class='synopsis'>
                  <span class='name'>private_key</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Private key
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000529-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000529-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 216</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">private_key</span>&#x000A;        <span class="ruby-ivar">@private_key</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_PRIVATE_KEY&quot;</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_PRIVATE_KEY&quot;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000528'>
                <a name='M000528'>      </a>
                <div class='synopsis'>
                  <span class='name'>pub_key</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  The keys are used only for puppet certificates and are only used for EC2.
                  Public key
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000528-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000528-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 212</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pub_key</span>&#x000A;        <span class="ruby-ivar">@pub_key</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_CERT&quot;</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_CERT&quot;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000534'>
                <a name='M000534'>      </a>
                <div class='synopsis'>
                  <span class='name'>reset_base!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000534-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000534-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 247</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_base!</span>&#x000A;        <span class="ruby-ivar">@describe_instances</span> = <span class="ruby-ivar">@cached_descriptions</span> = <span class="ruby-keyword kw">nil</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000512'>
                <a name='M000512'>      </a>
                <div class='synopsis'>
                  <span class='name'>terminate_instance!</span>
                  <span class='arguments'>(o={})</span>
                </div>
                <div class='description'>
                  <p>
                  Terminate an instance by id
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000512-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000512-source'><span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 70</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">terminate_instance!</span>(<span class="ruby-identifier">o</span>={})&#x000A;        <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>).<span class="ruby-identifier">terminate_instances</span>(<span class="ruby-identifier">:instance_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>])&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
