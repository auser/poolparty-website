<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: PoolParty::Remote::Ec2</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">PoolParty::Remote::Ec2</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/poolparty/net/remoter_bases/ec2/ec2_rb.html">
                lib/poolparty/net/remoter_bases/ec2/ec2.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Remote::RemoterBase
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000506">after_install_tasks_for</a>&nbsp;&nbsp;
      <a href="#M000496">after_launch_instance</a>&nbsp;&nbsp;
      <a href="#M000497">associate_address</a>&nbsp;&nbsp;
      <a href="#M000495">aws_keys</a>&nbsp;&nbsp;
      <a href="#M000499">create_keypair</a>&nbsp;&nbsp;
      <a href="#M000500">create_snapshot</a>&nbsp;&nbsp;
      <a href="#M000507">custom_configure_tasks_for</a>&nbsp;&nbsp;
      <a href="#M000505">custom_install_tasks_for</a>&nbsp;&nbsp;
      <a href="#M000504">custom_minimum_runnable_options</a>&nbsp;&nbsp;
      <a href="#M000488">describe_instance</a>&nbsp;&nbsp;
      <a href="#M000489">describe_instances</a>&nbsp;&nbsp;
      <a href="#M000490">ec2</a>&nbsp;&nbsp;
      <a href="#M000491">ec2</a>&nbsp;&nbsp;
      <a href="#M000493">get_descriptions</a>&nbsp;&nbsp;
      <a href="#M000492">get_instances_description</a>&nbsp;&nbsp;
      <a href="#M000501">has_cert_and_key?</a>&nbsp;&nbsp;
      <a href="#M000494">keypair</a>&nbsp;&nbsp;
      <a href="#M000485">launch_new_instance!</a>&nbsp;&nbsp;
      <a href="#M000486">launch_new_instance!</a>&nbsp;&nbsp;
      <a href="#M000498">next_unused_elastic_ip</a>&nbsp;&nbsp;
      <a href="#M000503">private_key</a>&nbsp;&nbsp;
      <a href="#M000502">pub_key</a>&nbsp;&nbsp;
      <a href="#M000508">reset_base!</a>&nbsp;&nbsp;
      <a href="#M000487">terminate_instance!</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000491" class="method-detail">
        <a name="M000491"></a>

        <div class="method-heading">
          <a href="#M000491" class="method-signature">
          <span class="method-name">ec2</span><span class="method-args">(o)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000491-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000491-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 108</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>)
        <span class="ruby-ivar">@ec2</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">EC2</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">:access_key_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:access_key</span>], 
                                <span class="ruby-identifier">:secret_access_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:secret_access_key</span>]
                              )
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000485" class="method-detail">
        <a name="M000485"></a>

        <div class="method-heading">
          <a href="#M000485" class="method-signature">
          <span class="method-name">launch_new_instance!</span><span class="method-args">(parent_cloud, o)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Requires a hash of options
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000485-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000485-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 50</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">launch_new_instance!</span>(<span class="ruby-identifier">parent_cloud</span>, <span class="ruby-identifier">o</span>)
        <span class="ruby-identifier">new</span>(<span class="ruby-identifier">parent_cloud</span>, <span class="ruby-identifier">o</span>).<span class="ruby-identifier">launch_new_instance!</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000506" class="method-detail">
        <a name="M000506"></a>

        <div class="method-heading">
          <a href="#M000506" class="method-signature">
          <span class="method-name">after_install_tasks_for</span><span class="method-args">(o)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000506-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000506-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 228</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_install_tasks_for</span>(<span class="ruby-identifier">o</span>)
        [
          <span class="ruby-comment cmt"># &quot;cd /var/poolparty &amp;&amp; wget http://rubyforge.org/frs/download.php/43666/amazon-ec2-0.3.1.gem -O amazon-ec2.gem 2&gt;&amp;1&quot;,</span>
          <span class="ruby-comment cmt"># &quot;/usr/bin/gem install --no-ri --no-rdoc amazon-ec2.gem 2&gt;&amp;1&quot;</span>
        ]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000496" class="method-detail">
        <a name="M000496"></a>

        <div class="method-heading">
          <a href="#M000496" class="method-signature">
          <span class="method-name">after_launch_instance</span><span class="method-args">(inst)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000496-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000496-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 139</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_launch_instance</span>(<span class="ruby-identifier">inst</span>)
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">inst</span>
          <span class="ruby-identifier">associate_address</span>(<span class="ruby-identifier">inst</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000497" class="method-detail">
        <a name="M000497"></a>

        <div class="method-heading">
          <a href="#M000497" class="method-signature">
          <span class="method-name">associate_address</span><span class="method-args">(instance=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Associate an address with the instance using <a
href="Ec2.html#M000490">ec2</a> Get the <a
href="Ec2.html#M000498">next_unused_elastic_ip</a> and if there is one,
associate the instance to the public ip
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000497-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000497-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 149</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">associate_address</span>(<span class="ruby-identifier">instance</span>=<span class="ruby-keyword kw">nil</span>)
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ip</span> = <span class="ruby-identifier">next_unused_elastic_ip</span>
          <span class="ruby-identifier">vputs</span> <span class="ruby-node">&quot;Associating #{instance.instance_id} with #{ip}&quot;</span>
          <span class="ruby-identifier">ec2</span>.<span class="ruby-identifier">associate_address</span>(<span class="ruby-identifier">:instance_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">instance</span>.<span class="ruby-identifier">instance_id</span>, <span class="ruby-identifier">:public_ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ip</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000495" class="method-detail">
        <a name="M000495"></a>

        <div class="method-heading">
          <a href="#M000495" class="method-signature">
          <span class="method-name">aws_keys</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../../Class.html">Class</a> method helpers
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000495-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000495-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 129</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">aws_keys</span>
        <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@access_key</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@secret_access_key</span>          
          <span class="ruby-identifier">aws_keys</span> = {}
          <span class="ruby-identifier">aws_keys</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-value str">'/etc/poolparty/aws_keys.yml'</span>) ) <span class="ruby-keyword kw">rescue</span> <span class="ruby-value str">'No aws_keys.yml file.   Will try to use enviornment variables'</span>
          <span class="ruby-ivar">@access_key</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">aws_keys</span>[<span class="ruby-identifier">:access_key</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AMAZON_ACCESS_KEY_ID'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AWS_ACCESS_KEY'</span>]
          <span class="ruby-ivar">@secret_access_key</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">aws_keys</span>[<span class="ruby-identifier">:secret_access_key</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AMAZON_SECRET_ACCESS_KEY'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'AWS_SECRET_ACCESS_KEY'</span>]
        <span class="ruby-keyword kw">end</span>
        [<span class="ruby-ivar">@access_key</span>, <span class="ruby-ivar">@secret_access_key</span>]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000499" class="method-detail">
        <a name="M000499"></a>

        <div class="method-heading">
          <a href="#M000499" class="method-signature">
          <span class="method-name">create_keypair</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Help create a <a href="Ec2.html#M000494">keypair</a> for the cloud This is
a helper to create the <a href="Ec2.html#M000494">keypair</a> and add them
to the cloud for you
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000499-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000499-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 184</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_keypair</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keypair</span>
        <span class="ruby-keyword kw">unless</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-identifier">new_keypair_path</span> )
          <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>( <span class="ruby-identifier">new_keypair_path</span> )
          <span class="ruby-identifier">vputs</span> <span class="ruby-node">&quot;Creating keypair: #{keypair} in #{new_keypair_path}&quot;</span>
          <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">system</span> <span class="ruby-node">&quot;ec2-add-keypair #{keypair} &gt; #{new_keypair_path} &amp;&amp; chmod 600 #{new_keypair_path}&quot;</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000500" class="method-detail">
        <a name="M000500"></a>

        <div class="method-heading">
          <a href="#M000500" class="method-signature">
          <span class="method-name">create_snapshot</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
wrapper for remote base to perform a snapshot backup for the ebs volume
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000500-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000500-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 194</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_snapshot</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ebs_volume_id</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">ec2</span>.<span class="ruby-identifier">create_snapshot</span>(<span class="ruby-identifier">:volume_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ebs_volume_id</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000507" class="method-detail">
        <a name="M000507"></a>

        <div class="method-heading">
          <a href="#M000507" class="method-signature">
          <span class="method-name">custom_configure_tasks_for</span><span class="method-args">(o)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000507-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000507-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 235</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">custom_configure_tasks_for</span>(<span class="ruby-identifier">o</span>)
        [
        ]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000505" class="method-detail">
        <a name="M000505"></a>

        <div class="method-heading">
          <a href="#M000505" class="method-signature">
          <span class="method-name">custom_install_tasks_for</span><span class="method-args">(o)</span>
          </a>
        </div>
      
        <div class="method-description">
          <pre>
 Hook
</pre>
<p>
TODO#: Change this so they match with the cap tasks
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000505-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000505-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 219</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">custom_install_tasks_for</span>(<span class="ruby-identifier">o</span>)        
        [
          <span class="ruby-comment cmt"># &quot;if [ -z $(grep -v '#' /etc/hosts | grep '#{o.name}') ]; then echo \&quot;$(curl http://169.254.169.254/latest/meta-data/public-ipv4) #{o.name}\&quot; &gt;&gt; /etc/hosts; fi&quot;,</span>
          <span class="ruby-node">&quot;if [ -z \&quot;$(grep -v '#' /etc/hosts | grep '#{o.name}')\&quot; ]; then echo '127.0.0.1 #{o.name}' &gt;&gt; /etc/hosts; fi&quot;</span>,
          <span class="ruby-node">&quot;hostname #{o.name}&quot;</span>,
          <span class="ruby-node">&quot;echo #{o.name} &gt; /etc/hostname&quot;</span>
        ]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000504" class="method-detail">
        <a name="M000504"></a>

        <div class="method-heading">
          <a href="#M000504" class="method-signature">
          <span class="method-name">custom_minimum_runnable_options</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000504-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000504-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 213</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">custom_minimum_runnable_options</span>
        [<span class="ruby-identifier">:ami</span>, <span class="ruby-identifier">:availabilty_zone</span>, <span class="ruby-identifier">:security_group</span>]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000488" class="method-detail">
        <a name="M000488"></a>

        <div class="method-heading">
          <a href="#M000488" class="method-signature">
          <span class="method-name">describe_instance</span><span class="method-args">(o={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Describe an instance&#8216;s status
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000488-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000488-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 74</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">describe_instance</span>(<span class="ruby-identifier">o</span>={})
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">describe_instances</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">describe_instances</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:name</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:ip</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:instance_id</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>] }
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000489" class="method-detail">
        <a name="M000489"></a>

        <div class="method-heading">
          <a href="#M000489" class="method-signature">
          <span class="method-name">describe_instances</span><span class="method-args">(o={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
TODO: Clean up this method and remove hostnames
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000489-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000489-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 79</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">describe_instances</span>(<span class="ruby-identifier">o</span>={})
        <span class="ruby-identifier">id</span> = <span class="ruby-value">0</span>
        <span class="ruby-identifier">get_instances_description</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">o</span>)).<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span>          
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">:status</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;running&quot;</span>
            <span class="ruby-identifier">inst_name</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;master&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;node#{id}&quot;</span>
            <span class="ruby-identifier">id</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">inst_name</span> = <span class="ruby-node">&quot;#{h[:status]}_node#{i}&quot;</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">h</span>.<span class="ruby-identifier">merge!</span>({
            <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">inst_name</span>,
            <span class="ruby-identifier">:hostname</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">:ip</span>],
            <span class="ruby-identifier">:ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">:ip</span>].<span class="ruby-identifier">convert_from_ec2_to_ip</span>,
            <span class="ruby-identifier">:index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>,  <span class="ruby-comment cmt">#TODO MF get the instance id from the aws result instead</span>
            <span class="ruby-identifier">:launching_time</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">:launching_time</span>])
          })
        <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">sort</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:index</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">:index</span>] }
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000490" class="method-detail">
        <a name="M000490"></a>

        <div class="method-heading">
          <a href="#M000490" class="method-signature">
          <span class="method-name">ec2</span><span class="method-args">(o={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return or create a new base EC2 connection object that will actually
connect to <a href="Ec2.html#M000490">ec2</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000490-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000490-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 103</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>={})
        <span class="ruby-ivar">@ec2</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">EC2</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">:access_key_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:access_key</span>], 
                                <span class="ruby-identifier">:secret_access_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:secret_access_key</span>]
                              )
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000493" class="method-detail">
        <a name="M000493"></a>

        <div class="method-heading">
          <a href="#M000493" class="method-signature">
          <span class="method-name">get_descriptions</span><span class="method-args">(o={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000493-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000493-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 120</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_descriptions</span>(<span class="ruby-identifier">o</span>={})
        <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">get_descriptions</span>(<span class="ruby-identifier">o</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000492" class="method-detail">
        <a name="M000492"></a>

        <div class="method-heading">
          <a href="#M000492" class="method-signature">
          <span class="method-name">get_instances_description</span><span class="method-args">(o={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the <a href="Ec2.html#M000490">ec2</a> description for the response in
a hash format
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000492-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000492-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 115</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_instances_description</span>(<span class="ruby-identifier">o</span>={})
        <span class="ruby-comment cmt">#TODO: only use keypair.full_filepath</span>
        <span class="ruby-identifier">key_hash</span> = {<span class="ruby-identifier">:keypair</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">keypair</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">full_filepath</span>)}
        <span class="ruby-constant">EC2ResponseObject</span>.<span class="ruby-identifier">get_descriptions</span>(<span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>).<span class="ruby-identifier">describe_instances</span>).<span class="ruby-identifier">select_with_hash</span>(<span class="ruby-identifier">key_hash</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000501" class="method-detail">
        <a name="M000501"></a>

        <div class="method-heading">
          <a href="#M000501" class="method-signature">
          <span class="method-name">has_cert_and_key?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000501-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000501-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 199</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_cert_and_key?</span>
        <span class="ruby-identifier">pub_key</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">private_key</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000494" class="method-detail">
        <a name="M000494"></a>

        <div class="method-heading">
          <a href="#M000494" class="method-signature">
          <span class="method-name">keypair</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000494-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000494-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 124</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keypair</span>
        <span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">keypair</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000486" class="method-detail">
        <a name="M000486"></a>

        <div class="method-heading">
          <a href="#M000486" class="method-signature">
          <span class="method-name">launch_new_instance!</span><span class="method-args">(o={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
TODO: Fix the key_name issue Start a new instance with the given options
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000486-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000486-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 56</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">launch_new_instance!</span>(<span class="ruby-identifier">o</span>={})
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;You must pass a keypair to launch an instance, or else you will not be able to login. options = #{o.inspect}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">keypair</span>
        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">merge!</span>( <span class="ruby-identifier">options</span> ).<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">:key_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">basename</span>)
        <span class="ruby-identifier">instance</span> = <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>).<span class="ruby-identifier">run_instances</span>(<span class="ruby-identifier">o</span>)
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-identifier">h</span> = <span class="ruby-constant">EC2ResponseObject</span>.<span class="ruby-identifier">get_hash_from_response</span>(<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">instancesSet</span>.<span class="ruby-identifier">item</span>.<span class="ruby-identifier">first</span>)
          <span class="ruby-comment cmt">#h = instance.instancesSet.item.first</span>
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
          <span class="ruby-identifier">h</span> = <span class="ruby-constant">EC2ResponseObject</span>.<span class="ruby-identifier">get_hash_from_response</span>(<span class="ruby-identifier">instance</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">instance</span>
          <span class="ruby-comment cmt"># h = instance</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">h</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000498" class="method-detail">
        <a name="M000498"></a>

        <div class="method-heading">
          <a href="#M000498" class="method-signature">
          <span class="method-name">next_unused_elastic_ip</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the next usable elastic ip First, get the list of addresses from <a
href="Ec2.html#M000490">ec2</a> that the client has access to, then select
only the ones that are not associated with an instance. If the cloud has
set elastic_ips to use, then, using the intersection of the unused ips and
those, find the first one available and return that, otherwise, return the
first elastic ip available
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000498-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000498-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 163</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_unused_elastic_ip</span>
        <span class="ruby-comment cmt"># [{&quot;instanceId&quot;=&gt;nil, &quot;publicIp&quot;=&gt;&quot;174.129.212.93&quot;}, {&quot;instanceId&quot;=&gt;nil, &quot;publicIp&quot;=&gt;&quot;174.129.212.94&quot;}]</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">addressesSet</span> = <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">describe_addresses</span>[<span class="ruby-value str">&quot;addressesSet&quot;</span>]
          <span class="ruby-keyword kw">begin</span>
            <span class="ruby-identifier">empty_addresses</span> = <span class="ruby-identifier">addressesSet</span>[<span class="ruby-value str">&quot;item&quot;</span>].<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>[<span class="ruby-value str">&quot;instanceId&quot;</span>].<span class="ruby-identifier">nil?</span> }
            <span class="ruby-identifier">ips</span> = <span class="ruby-identifier">empty_addresses</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">addr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">addr</span>[<span class="ruby-value str">&quot;publicIp&quot;</span>]}
            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">elastic_ips?</span>
              <span class="ruby-identifier">ips_to_use</span> = <span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">elastic_ips</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">ips</span>
              <span class="ruby-identifier">ips_to_use</span>.<span class="ruby-identifier">first</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-identifier">ips</span>.<span class="ruby-identifier">first</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
            <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Error: #{e}&quot;</span>
            <span class="ruby-keyword kw">nil</span>
          <span class="ruby-keyword kw">end</span>          
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000503" class="method-detail">
        <a name="M000503"></a>

        <div class="method-heading">
          <a href="#M000503" class="method-signature">
          <span class="method-name">private_key</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Private key
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000503-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000503-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 209</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">private_key</span>
        <span class="ruby-ivar">@private_key</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_PRIVATE_KEY&quot;</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_PRIVATE_KEY&quot;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000502" class="method-detail">
        <a name="M000502"></a>

        <div class="method-heading">
          <a href="#M000502" class="method-signature">
          <span class="method-name">pub_key</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The keys are used only for puppet certificates and are only used for EC2.
Public key
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000502-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000502-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 205</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pub_key</span>
        <span class="ruby-ivar">@pub_key</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_CERT&quot;</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;EC2_CERT&quot;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000508" class="method-detail">
        <a name="M000508"></a>

        <div class="method-heading">
          <a href="#M000508" class="method-signature">
          <span class="method-name">reset_base!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000508-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000508-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 240</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_base!</span>
        <span class="ruby-ivar">@describe_instances</span> = <span class="ruby-ivar">@cached_descriptions</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000487" class="method-detail">
        <a name="M000487"></a>

        <div class="method-heading">
          <a href="#M000487" class="method-signature">
          <span class="method-name">terminate_instance!</span><span class="method-args">(o={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Terminate an instance by id
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000487-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000487-source">
<pre>
<span class="ruby-comment cmt"># File lib/poolparty/net/remoter_bases/ec2/ec2.rb, line 70</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">terminate_instance!</span>(<span class="ruby-identifier">o</span>={})
        <span class="ruby-identifier">ec2</span>(<span class="ruby-identifier">o</span>).<span class="ruby-identifier">terminate_instances</span>(<span class="ruby-identifier">:instance_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:instance_id</span>])
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>